---
layout: post
title: AS3 Type Conversion & Common Mistakes
date: '2010-03-21T19:41:00.001+07:00'
author: Thanh Tran
tags:
- Labs
- Flash
modified_time: '2011-05-06T12:49:32.893+07:00'
blogger_id: tag:blogger.com,1999:blog-5363322361445724369.post-2274207087918194257
blogger_orig_url: http://blog.int3ractive.com/2010/03/as3-type-conversion-common-mistakes.html
---

<p>In this article, I’ll discuss some common mistakes that AS3 developers (including myself) often make when working with (implicit) type conversion.</p>  <h4>1. Check whether a dynamic property is set</h4>  <p>Dynamic properties can be added to dynamic object at run-time. Consequently, there’s often a need to test whether they are set before using them.</p>  <p>Here’s how some developers do it:</p>  <div class="actionscript3">   <ol>     <li class="li1">       <div class="de1"><span class="kw2">var</span> initObj<span class="sy0">:</span> <a href="http://www.google.com/search?q=object%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:object.html"><span class="kw5">Object</span></a> = <span class="br0">{</span>embed<span class="sy0">:</span> <span class="kw1">true</span><span class="sy0">,</span> <span class="kw7">color</span><span class="sy0">:</span> 0xFF0000<span class="sy0">,</span> <span class="kw7">text</span><span class="sy0">:</span> <span class="st0">&quot;Hello&quot;</span> <span class="br0">}</span><span class="sy0">;</span> </div>     </li>      <li class="li1">       <div class="de1"><span class="co2">/* ... */</span>&#160;</div>     </li>      <li class="li1">       <div class="de1"><span class="kw1">if</span> <span class="br0">(</span>initObj<span class="sy0">.</span>embed<span class="br0">)</span> <span class="br0">{</span> <span class="co2">/*apply embed*/</span> <span class="br0">}</span> </div>     </li>      <li class="li1">       <div class="de1"><span class="kw1">if</span> <span class="br0">(</span>initObj<span class="sy0">.</span><span class="kw7">color</span><span class="br0">)</span> <span class="br0">{</span> <span class="co2">/*apply this color*/</span> <span class="br0">}</span> </div>     </li>      <li class="li2">       <div class="de2"><span class="kw1">if</span> <span class="br0">(</span>initObj<span class="sy0">.</span><span class="kw7">text</span><span class="br0">)</span> <span class="br0">{</span> <span class="co2">/*apply this text*/</span> <span class="br0">}</span></div>     </li>   </ol> </div>  <p>The first test with Boolean is ok. But be careful when the input for color is black (0x000000) or the text is empty (“”). In that case, <strong>zeros and empty strings casted to Boolean equal <font color="#0000ff" face="Courier New">false</font></strong>, and definitely the code will run incorrectly.</p>  <p>So, the best practice to check whether a dynamic property is set is to do as following:</p>  <div class="actionscript3">   <ol>     <li class="li1">       <div class="de1"><span class="kw1">if</span> <span class="br0">(</span>initObj<span class="sy0">.</span>embed <span class="sy0">!</span>= <span class="kw1">undefined</span><span class="br0">)</span> </div>     </li>      <li class="li1">       <div class="de1"><span class="kw1">if</span> <span class="br0">(</span>initObj<span class="sy0">.</span><span class="kw7">color</span> <span class="sy0">!</span>= <span class="kw1">undefined</span><span class="br0">)</span> </div>     </li>      <li class="li1">       <div class="de1"><span class="kw1">if</span> <span class="br0">(</span>initObj<span class="sy0">.</span><span class="kw7">text</span> <span class="sy0">!</span>= <span class="kw1">undefined</span><span class="br0">)</span></div>     </li>   </ol> </div> <a name='more'></a> <h4>2. Check whether an (E4X) XML node exists</h4>  <p>Given an XML like this:</p>  <div class="actionscript3"><span class="kw2">var</span> xml<span class="sy0">:</span> <a href="http://www.google.com/search?q=xml%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:xml.html"><span class="kw5">XML</span></a> =     <br />&lt;data&gt;     <br />&#160;&#160; &lt;book id=”b001”&gt;     <br />&#160;&#160;&#160;&#160;&#160; &lt;title&gt;Flash CS4&lt;/title&gt;     <br />&#160;&#160;&#160;&#160;&#160; &lt;author&gt;&lt;/author&gt;     <br />&#160;&#160; &lt;/book&gt;     <br />&lt;/data&gt;; </div>  <p>Since AS3, E4X has enabled a very neat way to select and get data from XML, something like:</p>  <div class="actionscript3"><span class="kw2">var</span> title<span class="sy0">:</span> <a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html"><span class="kw5">String</span></a> = xml<span class="sy0">.</span>book<span class="sy0">.</span><span class="br0">(</span>@id==<span class="st0">&quot;b001&quot;</span><span class="br0">)</span><span class="sy0">.</span>title<span class="sy0">;</span> </div>  <p>However, because it is so compact, many developers don’t realize there are a lot of implicit type conversions beneath.</p>  <p>They often check for the existence of a node by writing:</p>  <div class="actionscript3">if (xml.book.price)</div>  <p>Or check whether an element has data:</p>  <div class="actionscript3">if (xml.book.author)</div>  <p>Of even check whether an element exists with conditional selection:</p>  <div class="actionscript3">if (xml.book.(@id==&quot;b013&quot;))</div>  <p>They often assume that these XPath selections will return null or undefined if the elements/nodes don’t exist.</p>  <p>In fact,<strong> these tests always return <font color="#0000ff" face="Courier New">true</font> because for any XPath query in E4X, they always return an XMLList object</strong>. Obviously, if the selected element doesn’t exist, the XMLList object doesn’t have any child. And if the element exists but have no child or text value, it will return empty string “” when casted to String.</p>  <p>So the best practice to check for XML element is to write as following:</p>  <div class="actionscript3">if (xml.book.price[0]);&#160; <br /><font color="#008000">/* OR */</font>     <br />if (xml.book.price.toString());</div>  <p>For conditional selection, [0] notation is preferable because the condition may (by mistake) return more than one matched elements.</p>  <h4>3. Get Boolean value from String:</h4>  <p>Wrong:</p>  <div class="actionscript3">   <ol>     <li class="li1">       <div class="de1"><span class="co1">//even the flashvar equal “false”, any non-empty string will be casted to Boolean as true </span></div>     </li>      <li class="li1">       <div class="de1"><span class="kw2">var</span> autoPlay<span class="sy0">:</span> <a href="http://www.google.com/search?q=boolean%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:boolean.html"><span class="kw5">Boolean</span></a> = <span class="kw1">this</span><span class="sy0">.</span><span class="kw7">loaderInfo</span><span class="sy0">.</span><span class="kw7">parameters</span><span class="br0">[</span><span class="st0">&quot;autoPlay&quot;</span><span class="br0">]</span><span class="sy0">;</span></div>     </li>   </ol> </div>  <p>Right:</p>  <div class="actionscript3">   <ol>     <li class="li1">       <div class="de1"><span class="kw2">var</span> autoPlay<span class="sy0">:</span> <a href="http://www.google.com/search?q=boolean%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:boolean.html"><span class="kw5">Boolean</span></a> = <span class="br0">(</span><span class="kw1">this</span><span class="sy0">.</span><span class="kw7">loaderInfo</span><span class="sy0">.</span><span class="kw7">parameters</span><span class="br0">[</span><span class="st0">&quot;autoPlay&quot;</span><span class="br0">]<span class="sy0">.</span><span class="kw7">toLowerCase()</span></span> == <span class="st0">&quot;true&quot;</span><span class="br0">)</span> <span class="sy0">?</span> <span class="kw1">true</span> <span class="sy0">:</span> <span class="kw1">false</span><span class="sy0">;</span></div>     </li>   </ol> </div>  <h4>Reference:</h4>  <ul>   <li><a href="http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7f87.html" target="_blank">Adobe Help – Type Conversion</a> </li>    <li><a href="http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7f9d.html" target="_blank">Adobe Help – Variables &amp; default values</a> </li>    <li><a href="http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7e6b.html" target="_blank">Adobe Help – Traversing XML</a> </li> </ul>  <p><font size="1">[Vietnamese tag – Chuyển đổi kiểu dữ liệu trong AS3 và một số lỗi thường gặp]</font></p>