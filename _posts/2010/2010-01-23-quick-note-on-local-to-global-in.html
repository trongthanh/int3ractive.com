---
layout: post
title: Quick Note on Local to Global in Papervision3D
date: '2010-01-23T13:09:00.001+07:00'
author: Thanh Tran
tags:
- Flash 3D
- Flash
modified_time: '2011-05-06T11:06:02.623+07:00'
blogger_id: tag:blogger.com,1999:blog-5363322361445724369.post-2589614312272294299
blogger_orig_url: http://blog.int3ractive.com/2010/01/quick-note-on-local-to-global-in.html
---

<p>Normally, if you want to get the scene coordinates of a child 3D object, use these properties:</p>  <div class="actionscript3">   <ol>     <li class="li1">       <div class="de1"><span class="kw2">var</span> <span class="kw7">x</span><span class="sy0">:</span> <a href="http://www.google.com/search?q=number%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:number.html"><span class="kw5">Number</span></a> = <span class="kw7">child</span><span class="sy0">.</span>sceneX<span class="sy0">;</span></div>     </li>      <li class="li1">       <div class="de1"><span class="kw2">var</span> <span class="kw7">y</span><span class="sy0">:</span> <a href="http://www.google.com/search?q=number%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:number.html"><span class="kw5">Number</span></a> = <span class="kw7">child</span><span class="sy0">.</span>sceneY<span class="sy0">;</span></div>     </li>      <li class="li1">       <div class="de1"><span class="kw2">var</span> z<span class="sy0">:</span> <a href="http://www.google.com/search?q=number%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:number.html"><span class="kw5">Number</span></a> = <span class="kw7">child</span><span class="sy0">.</span>sceneZ<span class="sy0">;</span></div>     </li>   </ol> </div>  <p>However, if you want to get the screen coordinates of a local point other than the object’s original position (for e.g. side of a plane, some random points on a surface of a sphere…), then you have to deal with Matrix3D transform.</p>  <p>Don’t worry, you don’t need to understand what Matrix3D is because I don’t either :). Let’s use what people have concluded <a href="http://forum.papervision3d.org/viewtopic.php?f=14&amp;t=1617&amp;start=0" target="_blank">here</a>:</p>  <blockquote style="background: #ddffdd">   <p><em>If local to global is: </em></p>    <p><em><font face="Courier New">child.transform.calculateMultiply(parent.world, child.transform);</font> </em></p>    <p><em>then global to local is: </em></p>    <p><em><font face="Courier New">child.transform.calculateMultiply(Matrix3D.inverse(parent.world), child.transform);</font></em></p> </blockquote>  <p>There are 2 things to note with above conclusion:</p>  <ul>   <li>I have to invert method’s arguments (from what’s originally stated in the <a href="http://forum.papervision3d.org/viewtopic.php?f=14&amp;t=1617&amp;start=0" target="_blank">post</a>) to get the correct conversion. I’m using PV3D 2.1 </li>    <li><strike>I haven’t tried the global to local method, hence I don’t guarantee it works.</strike> The global to local transform works correctly. </li> </ul>  <p>So here’s how I convert any local positions to global:</p>  <div class="actionscript3">   <ol>     <li class="li1">       <div class="de1"><span class="kw2">var</span> <span class="kw7">matrix</span><span class="sy0">:</span> Matrix3D = Matrix3D<span class="sy0">.</span>IDENTITY<span class="sy0">;</span> <span class="co1">//a recommended way to create new Matrix3D </span></div>     </li>      <li class="li1">       <div class="de1"><span class="kw7">matrix</span><span class="sy0">.</span>n14 = <span class="kw7">localX</span><span class="sy0">;</span> </div>     </li>      <li class="li1">       <div class="de1"><span class="kw7">matrix</span><span class="sy0">.</span>n24 = <span class="kw7">localY</span><span class="sy0">;</span> </div>     </li>      <li class="li1">       <div class="de1"><span class="kw7">matrix</span><span class="sy0">.</span>n34 = localZ<span class="sy0">;</span> </div>     </li>      <li class="li1">       <div class="de1"><span class="kw7">matrix</span><span class="sy0">.</span>calculateMultiply<span class="br0">(</span><span class="kw7">child</span><span class="sy0">.</span><span class="kw7">parent</span><span class="sy0">.</span>world<span class="sy0">,</span> <span class="kw7">matrix</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">//child must be a DisplayObject3D </span></div>     </li>      <li class="li1">       <div class="de1"><span class="kw2">var</span> scenePos<span class="sy0">:</span> Number3D = <span class="kw1">new</span> Number3D<span class="br0">(</span><span class="kw7">matrix</span><span class="sy0">.</span>n14<span class="sy0">,</span> <span class="kw7">matrix</span><span class="sy0">.</span>n24<span class="sy0">,</span> <span class="kw7">matrix</span><span class="sy0">.</span>n34<span class="br0">)</span><span class="sy0">;</span></div>     </li>   </ol> </div>  <p>If you want to convert the rotation as well, use <font face="Courier New">Matrix3D.copy()</font> to copy all transformation info from the child object. And then after <font face="Courier New">calculateMultiply()</font>, apply the matrix to your scene object with <font face="Courier New">DisplayObject3D.copyTransform()</font>.</p>  <p><font size="1">[Vietnamese Tag – Chuyển đổi tọa độ local sang global trong Papervision3D]</font></p>